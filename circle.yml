machine:
  services:
    - docker
  environment:
    GOPATH: "/home/ubuntu/.go_workspace"
    ORG_PATH: "github.com/grafana"
    REPO_PATH: "${ORG_PATH}/grafana"

dependencies:
  pre:
    - rm -rf ${GOPATH}/src/${REPO_PATH}
    - mkdir -p ${GOPATH}/src/${ORG_PATH}
    - cp -r ~/grafana ${GOPATH}/src/${ORG_PATH}
  override:
    - make kausal-backend
    - make kausal-frontend
    - make kausal-image

#deployment:
#  gh_branch:
#    branch: master
#    commands:
#      - ./scripts/build/deploy.sh
#      - ./scripts/build/sign_packages.sh
#      - go run build.go sha-dist
#      - aws s3 sync ./dist s3://$BUCKET_NAME/master
#      - ./scripts/trigger_windows_build.sh ${APPVEYOR_TOKEN} ${CIRCLE_SHA1} master
#      - ./scripts/trigger_docker_build.sh ${TRIGGER_GRAFANA_PACKER_CIRCLECI_TOKEN}
#      - go run ./scripts/build/publish.go -apiKey ${GRAFANA_COM_API_KEY}
#  gh_tag:
#    tag: /^v[0-9]+(\.[0-9]+){2}(-.+|[^-.]*)$/
#    commands:
#      - ./scripts/build/deploy.sh
#      - ./scripts/build/sign_packages.sh
#      - go run build.go sha-dist
#      - aws s3 sync ./dist s3://$BUCKET_NAME/release
#      - ./scripts/trigger_windows_build.sh ${APPVEYOR_TOKEN} ${CIRCLE_SHA1} release
#      - ./scripts/trigger_docker_build.sh ${TRIGGER_GRAFANA_PACKER_CIRCLECI_TOKEN} ${CIRCLE_TAG}
